#!/bin/bash
# Aqverse PKG Pre-installation Script

set -e

PRODUCT_NAME="Aqverse"
LOG_FILE="/tmp/Aqverse-preinstall.log"

log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [PREINSTALL] $1" | tee -a "$LOG_FILE"
}

if [ "$EUID" -ne 0 ]; then
    log "Please run as root"
    exit 1
fi

log "Starting Aqverse pre-installation..."

# Check if application is currently running
if pgrep -f "$PRODUCT_NAME" > /dev/null; then
    log "Aqverse is currently running, attempting to quit..."
    osascript -e "tell application \"$PRODUCT_NAME\" to quit" 2>/dev/null || true
    sleep 2
    if pgrep -f "$PRODUCT_NAME" > /dev/null; then
        pkill -f "$PRODUCT_NAME" || true
    fi
    log "Aqverse has been stopped"
fi

log "Pre-installation completed successfully"
exit 0
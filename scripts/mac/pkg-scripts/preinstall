#!/bin/bash
# Game Launcher PKG Pre-installation Script

set -e

PRODUCT_NAME="Game Launcher"
LOG_FILE="/tmp/GameLauncher-preinstall.log"

log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') [PREINSTALL] $1" | tee -a "$LOG_FILE"
}

log "Starting Game Launcher pre-installation..."

# Check if application is currently running
if pgrep -f "$PRODUCT_NAME" > /dev/null; then
    log "Game Launcher is currently running, attempting to quit..."
    osascript -e "tell application \"$PRODUCT_NAME\" to quit" 2>/dev/null || true
    sleep 2
    if pgrep -f "$PRODUCT_NAME" > /dev/null; then
        pkill -f "$PRODUCT_NAME" || true
    fi
    log "Game Launcher has been stopped"
fi

log "Pre-installation completed successfully"
exit 0